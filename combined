SELECT
    TIMESTAMP_MICROS(event_timestamp) as event_timestamp,
    user_pseudo_id,
    event_name,
    lower((select value.string_value from unnest(event_params) where key = 'source')) as all_event_source,
    lower((select value.string_value from unnest(event_params) where key = 'medium')) as all_event_medium,
    lower((select value.string_value from unnest(event_params) where key = 'campaign')) as all_event_campaign,
    traffic_source.source as user_source,
    traffic_source.medium as user_medium,
    traffic_source.name as user_campaign,
    collected_traffic_source.manual_source as collected_event_source,
    collected_traffic_source.manual_medium as collected_event_medium,
    collected_traffic_source.manual_campaign_name as collected_event_campaign,
    session_traffic_source_last_click.manual_campaign.source as lastclick_manual_session_source,
    session_traffic_source_last_click.manual_campaign.medium as lastclick_manual_session_medium,
    session_traffic_source_last_click.manual_campaign.campaign_name as lastclick_manual_session_campaign,
    session_traffic_source_last_click.cross_channel_campaign.source as lastclick_crosschannel_session_source,
    session_traffic_source_last_click.cross_channel_campaign.medium as lastclick_crosschannel_session_medium,
    session_traffic_source_last_click.cross_channel_campaign.campaign_name as lastclick_crosschannel_session_campaign,
from `enter.tablename_123456.events_*`
GROUP BY ALL
